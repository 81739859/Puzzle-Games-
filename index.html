<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ§© Kids Puzzle Game</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  font-family: 'Inter', sans-serif;
  color: #fff;
}
.tile{
  transition: all .2s cubic-bezier(0.4, 0, 0.2, 1);
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255,255,255,0.2);
}
.tile:active{ transform: scale(0.92); }
.tile.win{ animation: bounce 0.6s ease; }
@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: scale(1); }
  40% { transform: scale(1.08); }
  60% { transform: scale(1.04); }
}
.particle{ animation: explode 0.8s ease-out forwards; }
@keyframes explode {
  0% { transform: scale(0) rotate(0deg); opacity: 1; }
  100% { transform: scale(2) rotate(180deg); opacity: 0; }
}
</style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

<!-- POPUP MODAL -->
<div id="popup" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="bg-white/90 backdrop-blur-xl rounded-3xl p-8 w-72 text-center shadow-2xl">
    <div id="popupIcon" class="text-4xl mx-auto mb-4">ğŸ‰</div>
    <div id="popupText" class="text-xl font-bold text-gray-800 mb-6 min-h-[1.25rem]"></div>
    <button onclick="hidePopup()" class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold rounded-2xl text-lg shadow-lg hover:scale-105 transition-all">
      OK âœ“
    </button>
  </div>
</div>

<!-- SPLASH -->
<div id="splash" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-gradient-to-br from-pink-500 via-purple-500 to-indigo-600 animate-pulse">
  <div class="text-4xl font-black mb-4 drop-shadow-2xl">ğŸ§© Kids Puzzle</div>
  <p class="text-lg opacity-90 mb-8 drop-shadow-lg">Fun â€¢ Learn â€¢ Play</p>
  <div class="w-16 h-16 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
</div>

<!-- HOME -->
<div id="home" class="hidden w-full max-w-[400px] flex flex-col gap-8 text-center">
  <div class="text-4xl font-black mb-2 bg-gradient-to-r from-yellow-400 via-pink-400 to-blue-400 bg-clip-text text-transparent drop-shadow-2xl">
    ğŸ§© Kids Puzzle Game
  </div>
  <p class="text-lg text-white/80">Play â€¢ Learn â€¢ Enjoy âœ¨</p>

  <button onclick="startFromHome()" class="py-6 px-12 bg-gradient-to-r from-emerald-400 via-teal-400 to-blue-500 text-black font-black rounded-3xl text-2xl shadow-2xl hover:scale-105 transition-all">
    â–¶ï¸ START PLAYING
  </button>

  <div class="grid grid-cols-2 gap-4">
    <div class="bg-white/10 backdrop-blur-xl p-6 rounded-2xl border border-white/20 hover:scale-105 transition-all">
      <div class="text-3xl mb-2">ğŸ”¢</div> <div class="font-bold text-lg">Numbers</div>
    </div>
    <div class="bg-white/10 backdrop-blur-xl p-6 rounded-2xl border border-white/20 hover:scale-105 transition-all">
      <div class="text-3xl mb-2">ğŸ–¼ï¸</div> <div class="font-bold text-lg">Cartoons</div>
    </div>
    <div class="bg-white/10 backdrop-blur-xl p-6 rounded-2xl border border-white/20 hover:scale-105 transition-all">
      <div class="text-3xl mb-2">ğŸ”¤</div> <div class="font-bold text-lg">ABC</div>
    </div>
    <div class="bg-white/10 backdrop-blur-xl p-6 rounded-2xl border border-white/20 hover:scale-105 transition-all">
      <div class="text-3xl mb-2">ğŸ¨</div> <div class="font-bold text-lg">Colors</div>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game" class="hidden w-full max-w-[400px] flex flex-col gap-6">

  <!-- TOP BAR -->
  <div class="flex justify-between items-center">
    <div class="px-4 py-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-black font-bold rounded-full text-lg shadow-lg">
      ğŸª™ <span id="coins">0</span>
    </div>
    <div class="px-4 py-2 bg-gradient-to-r from-blue-400 to-indigo-500 text-black font-bold rounded-full text-lg shadow-lg">
      Level <span id="level">1</span>
    </div>
  </div>

  <!-- LEVEL INFO -->
  <div class="text-center">
    <p id="levelInfo" class="text-lg font-bold text-white/90 bg-black/20 px-4 py-2 rounded-2xl backdrop-blur-sm">Loading...</p>
  </div>

  <!-- MODE BUTTONS -->
  <div class="grid grid-cols-4 gap-2">
    <button onclick="setMode('number')" class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm font-bold hover:bg-white/30 transition-all">ğŸ”¢</button>
    <button onclick="setMode('photo')" class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm font-bold hover:bg-white/30 transition-all">ğŸ–¼ï¸</button>
    <button onclick="setMode('alpha')" class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm font-bold hover:bg-white/30 transition-all">ğŸ”¤</button>
    <button onclick="setMode('color')" class="bg-white/20 p-3 rounded-2xl backdrop-blur-sm font-bold hover:bg-white/30 transition-all">ğŸ¨</button>
  </div>

  <!-- PUZZLE GRID -->
  <div class="relative bg-white/10 backdrop-blur-xl rounded-3xl p-4 border-4 border-white/20 shadow-2xl">
    <div id="grid" class="grid gap-2 w-full h-[320px]"></div>
    <div id="win" class="absolute inset-0 hidden bg-gradient-to-br from-green-500/90 to-emerald-500/90 flex flex-col items-center justify-center text-2xl font-black rounded-3xl">
      <div class="text-5xl mb-4 animate-bounce">ğŸ‰</div>
      <div id="winText">Great Job!</div>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="grid grid-cols-3 gap-3">
    <button onclick="useHint()" class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-2xl font-bold text-lg shadow-lg hover:scale-105">ğŸ’¡ Hint</button>
    <button onclick="skipLevel()" class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-2xl font-bold text-lg shadow-lg hover:scale-105">â­ Skip</button>
    <button onclick="watchAd()" class="bg-gradient-to-r from-emerald-500 to-teal-600 p-4 rounded-2xl font-bold text-lg shadow-lg hover:scale-105">ğŸ¬ +20</button>
  </div>

  <button onclick="goHome()" class="text-sm text-white/70 hover:text-white transition-all">ğŸ  Home</button>

</div>

<script>
let state = {
  level: 1, coins: 0, size: 3, tiles: [], empty: 0, mode: "number"
};

const alphabets = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
const colors = ["#ff6b6b", "#4ecdc4", "#45b7d1", "#f9ca24", "#f0932b", "#eb4d4b", "#6c5ce7", "#a29bfe"];
const photos = [...Array(50)].map((_, i) => `https://api.dicebear.com/7.x/avataaars/svg?seed=${i}`);

const levelConfigs = [
  // Levels 1-5: 3x3
  { mode: "number", size: 3, title: "ğŸ”¢ Arrange numbers 1-8" },
  { mode: "alpha", size: 3, title: "ğŸ”¤ Arrange A B C..." },
  { mode: "color", size: 3, title: "ğŸ¨ Arrange colors" },
  { mode: "photo", size: 3, title: "ğŸ–¼ï¸ Complete cartoon" },
  { mode: "number", size: 3, title: "ğŸ”¢ Numbers challenge" },
  
  // Levels 6-15: 4x4  
  { mode: "alpha", size: 4, title: "ğŸ”¤ A B C D order" },
  { mode: "color", size: 4, title: "ğŸ¨ Color sequence" },
  { mode: "photo", size: 4, title: "ğŸ–¼ï¸ Bigger cartoon" },
  { mode: "number", size: 4, title: "ğŸ”¢ 1-15 numbers" },
  { mode: "alpha", size: 4, title: "ğŸ”¤ Alphabet pro" },
  { mode: "color", size: 4, title: "ğŸ¨ Colors expert" },
  { mode: "photo", size: 4, title: "ğŸ–¼ï¸ Master cartoon" },
  { mode: "number", size: 4, title: "ğŸ”¢ Number master" },
  { mode: "alpha", size: 4, title: "ğŸ”¤ ABC champion" },
  { mode: "color", size: 4, title: "ğŸ¨ Color champion" },

  // Levels 16+: 5x5 (cycles)
  { mode: "photo", size: 5, title: "ğŸ–¼ï¸ Epic puzzle" },
  { mode: "number", size: 5, title: "ğŸ”¢ Legend numbers" },
];

setTimeout(() => {
  document.getElementById("splash").style.display = "none";
  document.getElementById("home").classList.remove("hidden");
  dailyReward();
}, 2500);

function startFromHome() {
  document.getElementById("home").classList.add("hidden");
  document.getElementById("game").classList.remove("hidden");
  loadGameState();
  startGame();
}

function dailyReward() {
  const d = new Date().toDateString();
  if (localStorage.getItem("lastPlay") !== d) {
    state.coins += 30;
    localStorage.setItem("lastPlay", d);
    showPopup("ğŸ Daily Login
+30 Coins!", "ğŸ˜");
  }
}

function loadGameState() {
  const saved = localStorage.getItem("puzzleState");
  if (saved) {
    const data = JSON.parse(saved);
    state.level = Math.max(1, data.level || 1);
    state.coins = data.coins || 0;
  }
}

function saveGameState() {
  localStorage.setItem("puzzleState", JSON.stringify({
    level: state.level,
    coins: state.coins
  }));
}

function setMode(m) {
  state.mode = m;
  startGame();
}

function startGame() {
  const cfg = levelConfigs[(state.level - 1) % levelConfigs.length];
  state.mode = cfg.mode;
  state.size = cfg.size;
  
  document.getElementById("level").innerText = state.level;
  document.getElementById("coins").innerText = state.coins;
  document.getElementById("levelInfo").innerText = cfg.title;
  
  makeSolvableShuffle();
  draw();
  saveGameState();
}

function makeSolvableShuffle() {
  const s = state.size;
  state.tiles = [...Array(s * s).keys()];
  state.empty = 0;
  
  // Make 200 random valid moves from solved state (always solvable)
  for (let k = 0; k < 200; k++) {
    const e = state.empty;
    const moves = [];
    const r = Math.floor(e / s), c = e % s;
    
    if (r > 0) moves.push(e - s);        // up
    if (r < s - 1) moves.push(e + s);    // down
    if (c > 0) moves.push(e - 1);        // left
    if (c < s - 1) moves.push(e + 1);    // right
    
    const to = moves[Math.floor(Math.random() * moves.length)];
    [state.tiles[e], state.tiles[to]] = [state.tiles[to], state.tiles[e]];
    state.empty = to;
  }
}

function draw() {
  const g = document.getElementById("grid");
  g.style.gridTemplateColumns = `repeat(${state.size}, 1fr)`;
  g.style.height = `${Math.min(320, 80 * state.size)}px`;
  g.innerHTML = "";
  
  state.tiles.forEach((v, i) => {
    const d = document.createElement("div");
    d.className = "tile rounded-2xl flex items-center justify-center font-black text-2xl h-full shadow-lg";
    
    if (v === 0) {
      d.classList.add("invisible");
    } else {
      if (state.mode === "number") {
        d.innerText = v;
        d.style.background = `linear-gradient(135deg, hsl(${v * 20}, 70%, 60%), hsl(${v * 20}, 70%, 50%))`;
      }
      if (state.mode === "alpha") {
        d.innerText = alphabets[v - 1];
        d.style.background = `linear-gradient(135deg, hsl(${v * 15}, 80%, 65%), hsl(${v * 15}, 80%, 55%))`;
      }
      if (state.mode === "color") {
        d.style.background = colors[v % colors.length];
        d.innerText = v;
      }
      if (state.mode === "photo") {
        d.innerHTML = `
          <div class="flex flex-col items-center p-2">
            <img src="${photos[(state.level + v) % photos.length]}" class="w-12 h-12 rounded-full mb-1 shadow-lg">
            <span class="text-sm">${v}</span>
          </div>`;
      }
      d.onclick = () => move(i);
    }
    g.appendChild(d);
  });
}

function move(i) {
  const e = state.empty, s = state.size;
  const r = Math.abs(Math.floor(i / s) - Math.floor(e / s));
  const c = Math.abs(i % s - e % s);
  
  if (r + c !== 1) return; // Not adjacent
  
  // Swap and animate
  [state.tiles[i], state.tiles[e]] = [state.tiles[e], state.tiles[i]];
  state.empty = i;
  draw();
  checkWin();
}

function checkWin() {
  for (let i = 1; i < state.tiles.length; i++) {
    if (state.tiles[i - 1] !== i) return;
  }
  
  // WIN!
  state.coins += 10 + Math.floor(state.level / 5);
  state.level++;
  document.getElementById("coins").innerText = state.coins;
  
  const w = document.getElementById("win");
  document.getElementById("winText").innerText = `Level ${state.level - 1} Complete! ğŸ‰`;
  w.classList.remove("hidden");
  
  // Win particles
  for (let i = 0; i < 12; i++) {
    const p = document.createElement("div");
    p.className = "particle absolute text-2xl";
    p.innerHTML = "âœ¨";
    p.style.left = `${Math.random() * 100}%`;
    p.style.top = `${Math.random() * 100}%`;
    document.getElementById("game").appendChild(p);
    setTimeout(() => p.remove(), 800);
  }
  
  setTimeout(() => {
    w.classList.add("hidden");
    startGame();
  }, 1500);
  saveGameState();
}

function showPopup(msg, icon = "ğŸ‰") {
  document.getElementById("popupIcon").innerText = icon;
  document.getElementById("popupText").innerText = msg;
  const p = document.getElementById("popup");
  p.classList.remove("hidden");
}

function hidePopup() {
  document.getElementById("popup").classList.add("hidden");
}

function useHint() {
  if (state.coins < 20) return showPopup("âŒ Not enough coins!
Need 20 coins", "ğŸ˜…");
  state.coins -= 20;
  document.getElementById("coins").innerText = state.coins;
  showPopup("ğŸ’¡ Move tiles next to empty space!", "ğŸ’¡");
  saveGameState();
}

function skipLevel() {
  if (state.coins < 40) return showPopup("âŒ Not enough coins!
Need 40 coins", "ğŸ˜…");
  state.coins -= 40;
  state.level++;
  document.getElementById("coins").innerText = state.coins;
  showPopup("â­ Level Skipped!", "ğŸš€");
  setTimeout(startGame, 800);
  saveGameState();
}

function watchAd() {
  state.coins += 20;
  document.getElementById("coins").innerText = state.coins;
  showPopup("ğŸ¬ +20 Coins!
Thanks for watching", "ğŸ’°");
  saveGameState();
}

function goHome() {
  document.getElementById("game").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
}
</script>

</body>
  </html>
